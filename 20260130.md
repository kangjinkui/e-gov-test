# 2026-01-30 작업 내역

## 개요
eGovFrame 프로젝트의 Maven 빌드 오류를 해결하고 프로젝트 환경을 구성함

## 프로젝트 구조

### 디렉토리 구성
```
egov-test/
├── pom.xml                    # Maven 프로젝트 설정
├── src/
│   └── main/
│       ├── java/              # Java 소스 코드
│       │   └── egovframework/
│       │       ├── example/   # eGovFrame 샘플 코드
│       │       └── lawmatcher/# 법령-조례 매칭 시스템 (메인)
│       └── resources/         # 설정 및 리소스 파일
│           ├── db/           # 데이터베이스 스크립트
│           ├── egovframework/
│           │   ├── message/  # 메시지 리소스
│           │   ├── properties/# 환경 설정
│           │   ├── spring/   # Spring 설정
│           │   └── sqlmap/   # MyBatis 매퍼
│           └── 초기계정       # 시스템 초기 계정 정보
└── target/                    # 빌드 산출물 (Git 제외)
```

### 주요 모듈

#### 1. lawmatcher (법령-조례 매칭 시스템)
프로젝트의 핵심 비즈니스 로직을 담당하는 모듈

**모듈 구성:**
- **auth**: 인증/인가 시스템
  - Spring Security 기반 사용자 인증
  - 역할 기반 접근 제어 (RBAC)

- **law**: 법령 관리
  - 법령 기본 정보 (Law)
  - 법령 개정 이력 (LawAmendment)
  - 법령 변경사항 (LawChange)
  - 법령 스냅샷 (LawSnapshot)

- **ordinance**: 조례 관리
  - 조례 기본 정보 (Ordinance)
  - 조례 조항 (OrdinanceArticle)
  - 법령-조례 매핑 (OrdinanceLawMapping)

- **department**: 부서 관리
  - 조례 관리 부서 정보

- **review**: 검토 시스템
  - 법령 개정에 따른 조례 검토

- **dashboard**: 대시보드
  - 통계 및 현황 정보

- **sync**: 데이터 동기화
  - 외부 시스템 연동
  - 스케줄링 작업

- **external**: 외부 시스템 연동
  - moleg: 법제처 API 연동

#### 2. example (eGovFrame 샘플)
표준프레임워크 샘플 코드

**아키텍처 패턴:**
각 모듈은 레이어드 아키텍처를 따름
```
controller/ → service/ → mapper/ → database
    ↓           ↓          ↓
   VO/       Service     MyBatis
 (Request)   Interface    SQL
```

### Spring 설정 파일
```
resources/egovframework/spring/
├── context-aspect.xml        # AOP 설정
├── context-common.xml         # 공통 설정
├── context-datasource.xml     # 데이터소스 설정
├── context-idgen.xml          # ID 생성 설정
├── context-mapper.xml         # MyBatis 매퍼 설정
├── context-properties.xml     # 프로퍼티 설정
└── context-transaction.xml    # 트랜잭션 설정
```

### 파일 통계
- **총 소스 파일**: 101개
  - Java 파일: 72개
  - XML 설정/매퍼 파일: 약 29개
- **빌드 산출물**: 569개 파일 (target/, Git에서 제외됨)

### 초기 계정 정보
```
admin / admin123 (ROLE_ADMIN)
user / user123 (ROLE_USER)
```
※ 위치: `src/main/초기계정`

## 해결한 문제들

### 1. Java 버전 호환성 문제

**문제:**
- Maven 컴파일러가 Java 17을 요구하는데 시스템에 두 가지 Java 버전이 설치됨
  - `javac`: 17.0.17 (컴파일러)
  - `java`: 21.0.9 (런타임)
- 초기 설정이 Java 21로 되어 있어 빌드 실패

**해결:**
- `pom.xml`의 Java 버전을 17로 변경
- Maven 컴파일러 플러그인 설정 변경: `release` → `source`/`target`

```xml
<properties>
    <java.version>17</java.version>
</properties>

<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-compiler-plugin</artifactId>
    <version>3.14.0</version>
    <configuration>
        <source>${java.version}</source>
        <target>${java.version}</target>
    </configuration>
</plugin>
```

### 2. Jakarta Annotations API 누락

**문제:**
- Java 9+에서 `javax.annotation` 패키지가 JDK에서 제거됨
- 19개 Java 파일에서 `javax.annotation.Resource` import 오류 (38개 컴파일 에러)

**해결:**
1. Jakarta Annotations API 의존성 추가
```xml
<dependency>
    <groupId>jakarta.annotation</groupId>
    <artifactId>jakarta.annotation-api</artifactId>
    <version>2.1.1</version>
</dependency>
```

2. 모든 Java 파일의 import 문 변경 (19개 파일)
```bash
# 일괄 변경 명령어
find src/main/java -name "*.java" -type f -exec sed -i 's/import javax\.annotation\.Resource;/import jakarta.annotation.Resource;/g' {} \;
```

**영향받은 파일:**
- `egovframework/lawmatcher/auth/service/CustomUserDetailsService.java`
- `egovframework/lawmatcher/department/**/*.java` (2개)
- `egovframework/lawmatcher/law/**/*.java` (8개)
- `egovframework/lawmatcher/ordinance/**/*.java` (6개)
- `egovframework/lawmatcher/review/**/*.java` (2개)

### 3. JAVA_HOME 환경 변수 미설정

**문제:**
- Javadoc 생성 중 `JAVA_HOME` 환경 변수가 설정되지 않아 빌드 실패

**해결:**
1. `~/.bashrc`에 JAVA_HOME 추가
```bash
export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
export PATH=$JAVA_HOME/bin:$PATH
```

2. 임시 빌드 명령어 (현재 세션)
```bash
JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64 mvn clean package
```

### 4. Git 저장소 관리 문제

**문제:**
- `.gitignore` 파일 부재로 빌드 산출물이 Git에 추적됨
- `target/` 디렉토리에 569개 파일 (104MB)
- 커밋할 파일 수가 50 → 360 → 590개로 계속 변경

**해결:**
- `.gitignore` 파일 생성하여 다음 항목 제외:
  - Maven 빌드 산출물 (`target/`, `*.jar`, `*.war`)
  - IDE 설정 파일 (`.idea/`, `.vscode/`, `.settings/`)
  - OS 파일 (`.DS_Store`, `Thumbs.db`)
  - 로그 및 임시 파일

**결과:**
- Git 추적 파일: 590개 → 23개로 축소

## 최종 빌드 결과

### 성공한 빌드
```
[INFO] BUILD SUCCESS
[INFO] Total time: 14.195 s
```

### 생성된 산출물
- WAR 파일: `egov-test/target/egov-test-1.0.0.war`
- Javadoc JAR: `egov-test/target/egov-test-1.0.0-javadoc.jar`
- 컴파일된 클래스: 72개 Java 소스 파일

### 경고 사항
- Javadoc 경고 26개 (문서화 주석 관련, 빌드에 무영향)

## 수정된 주요 파일

### 설정 파일
1. **egov-test/pom.xml**
   - Java 버전: 21 → 17
   - Jakarta Annotations API 의존성 추가
   - Maven 컴파일러 플러그인: release → source/target 변경

2. **.gitignore** (신규 생성)
   - Maven 빌드 산출물 제외
   - IDE 설정 파일 제외
   - OS 임시 파일 제외

3. **~/.bashrc**
   - JAVA_HOME 환경 변수 추가
   - PATH 환경 변수 업데이트

### 소스 코드 (19개 파일)
**import 문 변경:** `javax.annotation.Resource` → `jakarta.annotation.Resource`

1. auth/service/CustomUserDetailsService.java
2. department/controller/DepartmentController.java
3. department/service/impl/DepartmentServiceImpl.java
4. law/controller/LawAmendmentController.java
5. law/controller/LawChangeController.java
6. law/controller/LawController.java
7. law/controller/LawSnapshotController.java
8. law/service/impl/LawAmendmentServiceImpl.java
9. law/service/impl/LawChangeServiceImpl.java
10. law/service/impl/LawServiceImpl.java
11. law/service/impl/LawSnapshotServiceImpl.java
12. ordinance/controller/OrdinanceArticleController.java
13. ordinance/controller/OrdinanceController.java
14. ordinance/controller/OrdinanceLawMappingController.java
15. ordinance/service/impl/OrdinanceArticleServiceImpl.java
16. ordinance/service/impl/OrdinanceLawMappingServiceImpl.java
17. ordinance/service/impl/OrdinanceServiceImpl.java
18. review/controller/ReviewController.java
19. review/service/impl/ReviewServiceImpl.java

### Git 상태
- 커밋 대상 파일: 23개
  - 신규: .gitignore, 20260130.md
  - 수정: pom.xml, 19개 Java 파일, db.properties
  - 제외: target/ (569개 빌드 산출물)

## 향후 작업 시 참고사항

### Maven 빌드 명령어
```bash
# egov-test 디렉토리로 이동
cd /home/user/dev/e-gov-test/egov-test

# 빌드 실행
JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64 mvn clean package

# 또는 새 터미널에서 (.bashrc 적용 후)
mvn clean package
```

### 환경 정보

**시스템:**
- OS: Linux (WSL2) 6.6.87.2-microsoft-standard-WSL2
- Java 컴파일러: OpenJDK 17.0.17
- Java 런타임: OpenJDK 21.0.9
- Maven: 3.8.7

**프레임워크:**
- eGovFrame RTE: 5.0.0
- Spring Framework: 6.2.11
- Spring Security: 6.4.4
- MyBatis: eGovFrame 내장

**데이터베이스:**
- DBMS: PostgreSQL
- 연결 정보:
  - Host: localhost:5433
  - Database: egov_lawmatcher
  - Username: egov_user
  - Schema: auth.sql, sampledb.sql

## 문제 해결 요약

| 문제 | 원인 | 해결책 |
|------|------|--------|
| `release version 17 not supported` | javac 버전 불일치 | Java 버전을 17로 변경, source/target 사용 |
| `package javax.annotation does not exist` | Java 9+ API 변경 | Jakarta Annotations API 추가 |
| `cannot find symbol: class Resource` | import 문 오류 | javax → jakarta로 일괄 변경 |
| `JAVA_HOME is not correctly set` | 환경 변수 미설정 | .bashrc에 JAVA_HOME 추가 |
| Git 파일 수 급증 | target 디렉토리 추적 | .gitignore 생성 |

## 참고 자료
- eGovFrame 표준프레임워크: https://www.egovframe.go.kr
- Jakarta EE Annotations: https://jakarta.ee/specifications/annotations/
- Maven 컴파일러 플러그인: https://maven.apache.org/plugins/maven-compiler-plugin/
